{% load static %}
<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Anime Template">
    <meta name="keywords" content="Anime, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Game Shop</title>
    <link rel="icon" type="image/x-icon" href="/img/favicon.png">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" rel="stylesheet">


    <!-- Css Styles -->
     <link rel="stylesheet" href="{% static 'css/bootstrap.min.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/font-awesome.min.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/elegant-icons.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/plyr.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/nice-select.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/slicknav.min.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static '/css/style.css ' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/header.css'%}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/cart.css'%}" type="text/css">
</head>

<!-- Page Preloder -->
<div id="preloder">
    <div class="loader"></div>
</div>

<!-- Header Section Begin -->
<header class="header">
    <div class="container">
        <div class="row">
            <div class="col-lg-2">
                <div class="header__logo">
                    <a href="{% url 'home' %}">
                        <img src="{% static 'img/logo2.png' %}" alt="">
                    </a>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="header__nav">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li class="active"><a href="{% url 'home' %}">Homepage</a></li>
                            <li><a href="./categories.html">Categories <span class="arrow_carrot-down"></span></a>
                                <ul class="dropdown">
                                    <li><a href="./categories.html">Categories</a></li>
                                    <li><a href="ProductDetails.html">New Games</a></li>
                                    <li><a href="./anime-watching.html">Upcoming</a></li>
                                    <li><a href="./blog-details.html">Blog Details</a></li>
                                    <li><a href="./signup.html">Sign Up</a></li>
                                    <li><a href="./login.html">Login</a></li>
                                </ul>
                            </li>
                            <li><a href="./blog.html">Our Blog</a></li>
                            <li><a href="{% url 'view_cart' %}">Cart</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="col-lg-2">
                <div class="header__right">
                    <a href="#" class="search-switch"><i class="fa-solid fa-magnifying-glass"></i></a>
                    {% if user.is_authenticated %}
                        <a href="{% url 'logout' %}"><i class="fa-solid fa-right-to-bracket"></i></a>
                    {% else %}
                        <a href="{% url 'login' %}"><i class="fa-solid fa-user"></i></a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Header End -->
<!-- main content -->
  <!-- Cart Section Begin -->
<section class="cart spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="cart-title">Your Shopping Cart</h3>
                <div class="cart__table">
                    <table>
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if cart_items %}
                                {% for product_id, item in cart_items.items %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>
                                            <div class="cart__item__pic">
                                                <img src="{{ item.image_url }}" alt="{{ item.name }}" width="150" height="auto">
                                            </div>
                                        </td>
                                        <td>{{ item.name }}</td>
                                        <td>
                                            <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity('{{ product_id }}', 'decrease')">-</button>
                                            <span>{{ item.quantity }}</span>
                                            <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity('{{ product_id }}', 'increase')">+</button>
                                        </td>
                                        <td>{{ item.price }}</td>
                                        <td>{{ item.total }}</td>
                                        <td>
                                            <a href="{% url 'remove_from_cart' product_id %}" class="btn btn-danger">Remove</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="7">No games in your cart</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="cart__total">
                    <h5>Total: {{ total_price }}</h5>
                </div>
                <div class="cart__btns">
                    <a href="{% url 'home' %}" class="primary-btn">Continue Shopping</a>
                    <a href="#" class="primary-btn">Proceed to Checkout</a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Cart Section End -->

<script>
    // Function to update product quantity (increase or decrease)
     function updateQuantity(productId, action) {
        const url = `/update-cart/${productId}/${action}/`;
        window.location.href = url;
    }
    <script>
        function updateQuantity(productId, action) {
            var quantityElement = document.getElementById('quantity-' + productId);
            var currentQuantity = parseInt(quantityElement.innerText);

            // Điều chỉnh số lượng
            var newQuantity = action === 'increase' ? currentQuantity + 1 : (currentQuantity > 1 ? currentQuantity - 1 : 1);

            // Cập nhật lại số lượng trên giao diện người dùng
            quantityElement.innerText = newQuantity;

            // Gửi yêu cầu tới server để cập nhật số lượng
            $.ajax({
                type: 'POST',
                url: "{% url 'update_quantity' %}",  // Thay 'update_quantity' bằng tên URL bạn đã định nghĩa
                data: {
                    'product_id': productId,
                    'quantity': newQuantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    console.log("Cập nhật thành công:", response);
                },
                error: function(xhr, status, error) {
                    console.log("Lỗi khi cập nhật:", error);
                    // Nếu có lỗi, khôi phục lại số lượng ban đầu
                    quantityElement.innerText = currentQuantity;
                }
            });
    }
    </script>
</script>
<!-- end main content -->
<!-- Js Plugins -->
    <script src="{% static '/js/jquery-3.3.1.min.js'%}"></script>
    <script src="{% static '/js/bootstrap.min.js'%}"></script>
    <script src="{% static 'js/player.js'%}"></script>
    <script src="{% static 'js/jquery.nice-select.min.js'%}"></script>
    <script src="{% static 'js/mixitup.min.js' %}"></script>
    <script src="{% static 'js/jquery.slicknav.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
</body>
<!-- Cart Section End -->
</html>